---
import type { Locale } from "@/i18n/dictionaries";

interface Props {
    lang: Locale;
}

const { lang } = Astro.props;

const locales = {
    fr: { flag: "ðŸ‡«ðŸ‡·", name: "FranÃ§ais" },
    en: { flag: "ðŸ‡¬ðŸ‡§", name: "English" },
};

const otherLang: Locale = lang === "fr" ? "en" : "fr";
---

<div class="relative inline-block" id="locale-switcher">
    <button
        type="button"
        class="group px-3 pt-1.5 pb-1 text-gray-600 border bg-gray-50 hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm inline-flex items-center justify-center"
        id="language-selector"
    >
        {locales[lang].flag}
        <svg
            class="w-2.5 h-2.5 ml-2 pb-0.5"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 10 6"
        >
            <path
                class="text-gray-400 group-hover:text-gray-600"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 4 4 4-4"></path>
        </svg>
    </button>

    <div
        id="language-dropdown"
        class="hidden origin-top-right absolute right-0 mt-2 w-32 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5"
    >
        <ul
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="options-menu"
        >
            <li>
                <a
                    href={`/${lang}`}
                    class="flex px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 justify-center border-b"
                >
                    <span class="pt-0.5 me-2">{locales[lang].flag}</span>
                    <span>{locales[lang].name}</span>
                </a>
            </li>
            <li>
                <a
                    href={`/${otherLang}`}
                    class="flex px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 justify-center border-b"
                >
                    <span class="pt-0.5 me-2">{locales[otherLang].flag}</span>
                    <span>{locales[otherLang].name}</span>
                </a>
            </li>
        </ul>
    </div>
</div>

<script>
    const button = document.getElementById("language-selector");
    const dropdown = document.getElementById("language-dropdown");

    button?.addEventListener("click", (e) => {
        e.stopPropagation();
        dropdown?.classList.toggle("hidden");
    });

    document.addEventListener("click", () => {
        dropdown?.classList.add("hidden");
    });
</script>
